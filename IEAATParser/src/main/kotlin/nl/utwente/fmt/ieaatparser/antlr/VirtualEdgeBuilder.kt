package nl.utwente.fmt.ieaatparser.antlr

import pva.ConcreteConnection
import pva.ConcreteType
import pva.VirtualConnection

data class VirtualEdgeBuilder(val context : ConcreteType, val ref : VirtualConnection){
    fun buildEdges(ctx: VirtualEdgesParser.PathContext) = ctx.ID().map {
        it.text
    }.fold(listOf<ConcreteConnection>()) { current, next ->
        //Find the next reference
        val new = if(current.isEmpty()){
            context
        }else{
            current.last().target
        }.connectedTo.filter {
            it.label==next
        }.singleOrNull()
                ?: throw RuntimeException("Failed to resolve reference: $next")

        //Add it to the result
        current + new
    }
}